{"version":3,"sources":["api/api.js","components/events-list/EventsList.styles.jsx","components/events-list/EventsList.jsx","components/app/App.styles.jsx","components/app/App.jsx","components/consts.js","index.js"],"names":["login","a","refreshCount","updateToken","EVENTS","startTime","endTime","thumbnail","description","deleted","fetchEvents","userToken","Error","Object","values","markEventForDeletion","console","log","EventListContainer","styled","div","displayName","Event","onClick","getTimeString","date","Date","toTimeString","substring","EventsList","title","events","map","event","index","AppContainer","App","useState","userAuthToken","setUserAuthToken","setEvents","useEffect","initialLogin","token","getNewToken","interval","setInterval","clearInterval","updateEvents","deleteEvent","useCallback","length","some","prevEvents","error","availableEvents","useMemo","filter","deletedEvents","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.9cb26a3e.chunk.js","sourcesContent":["// This file simulates the responses you would expect from a server.\n// You do not need to make any changes to, or even look at, this file.\n\nexport const login = async () => {\n  return \"USER_TOKEN\";\n};\n\nlet refreshCount = 0;\nexport const updateToken = async () => {\n  refreshCount++;\n  return `NEW_USER_TOKEN${refreshCount}`;\n};\n\nconst EVENTS = {\n  1645520400000: {\n    startTime: 1645520400000,\n    endTime: 1645520700000,\n    thumbnail: \"https://picsum.photos/seed/1/300/200\",\n    description: \"Tesco delivery\",\n    deleted: false\n  },\n  1645525020000: {\n    startTime: 1645525020000,\n    endTime: 1645525050000,\n    thumbnail: \"https://picsum.photos/seed/2/300/200\",\n    description: \"Passing car\",\n    deleted: false\n  },\n  1645529080000: {\n    startTime: 1645529080000,\n    endTime: 1645529111000,\n    thumbnail: \"https://picsum.photos/seed/3/300/200\",\n    description: \"Amazon delivery\",\n    deleted: false\n  },\n  1645531200000: {\n    startTime: 1645531200000,\n    endTime: 1645534680000,\n    thumbnail: \"https://picsum.photos/seed/4/300/200\",\n    description: \"Go out for lunch\",\n    deleted: false\n  },\n  1645544700000: {\n    startTime: 1645544700000,\n    endTime: 1645544760000,\n    thumbnail: \"https://picsum.photos/seed/5/300/200\",\n    description: \"Children home from school\",\n    deleted: false\n  }\n};\n\nexport const fetchEvents = async (userToken) => {\n  if (!userToken) throw new Error(\"Unauthorized\");\n\n  return Object.values(EVENTS);\n};\n\nexport const markEventForDeletion = async (startTime) => {\n  if (!startTime) return;\n  EVENTS[startTime].deleted = true;\n  console.log(EVENTS);\n};\n","import styled from \"styled-components\";\n\nexport const EventListContainer = styled.div`\n  border: 1px solid black;\n  border-radius: 50px;\n  padding: 20px;\n  box-sizing: border-box;\n`;\n\nEventListContainer.displayName = \"EventListContainer\";\n\nexport const Event = styled.div`\n    background-image: url(\"${({ thumbnail }) => thumbnail}\");\n    color: white;\n    width: 300px;\n    height: 200px;\n    display: flex;\n    gap: 10px;\n    margin: 30px 0;\n    padding: 10px;\n    font-size: 20px;\n    box-sizing: border-box;\n    font-weight: 900;\n    ${({ onClick }) => onClick && \"cursor: pointer;\"}\n`;\n\nEvent.displayName = \"Event\";\n","import { EventListContainer, Event } from \"./EventsList.styles\";\n\nconst EventsList = ({ title, description, events, onClick }) => (\n  <EventListContainer>\n    <h1>{title}</h1>\n    <p>{description}</p>\n    {events.map((event, index) => (\n      <Event\n        key={index}\n        // on click prop passed to reduce array length\n        onClick={() => (onClick ? onClick(event) : null)}\n        thumbnail={event.thumbnail}\n      >\n        <span>{getTimeString(event.startTime)}</span>\n        <span>{event.description}</span>\n      </Event>\n    ))}\n  </EventListContainer>\n);\n\nexport const getTimeString = (date) =>\n  new Date(date).toTimeString().substring(0, 5);\n\nexport default EventsList;\n","import styled from \"styled-components\";\n\nexport const AppContainer = styled.div`\n  width: 100%;\n  display: grid;\n  gap: 20px;\n  grid-template-columns: 1fr 1fr;\n`;\n\nAppContainer.displayName = \"AppContainer\";\n","import { useState, useEffect, useMemo, useCallback } from \"react\";\n\nimport {\n  fetchEvents,\n  login,\n  markEventForDeletion,\n  updateToken\n} from \"../../api/api\";\nimport { FIVE_MINUTES, TEN_MINUTES } from \"../consts\";\n\nimport EventsList from \"../events-list\";\nimport { AppContainer } from \"./App.styles\";\n\nconst App = () => {\n  // User auth token.\n  // This is needed to fetch events.\n  const [userAuthToken, setUserAuthToken] = useState(\"\");\n\n  const [events, setEvents] = useState([]);\n\n  // Initial login to get user auth token.\n  useEffect(() => {\n    const initialLogin = async () => {\n      const token = await login();\n      setUserAuthToken(token);\n    };\n    initialLogin();\n\n    // clean up for unmounting\n    return () => {\n      setUserAuthToken(\"\");\n    };\n  }, []);\n\n  // Refresh user auth token every 10 mins.\n  useEffect(() => {\n    const getNewToken = async () => {\n      const token = await updateToken(userAuthToken);\n      setUserAuthToken(token);\n    };\n\n    const interval = setInterval(() => getNewToken(), TEN_MINUTES);\n    // clean up for clearing interval\n    return () => clearInterval(interval);\n  }, [userAuthToken]);\n\n  // Fetch initial events.\n  // Then fetch events every 5 mins in case of changes (e.g. new event generated).\n  useEffect(() => {\n    const updateEvents = async () => {\n      if (userAuthToken) {\n        // fetchEvents() returns array of all events generated by the user's camera.\n        const events = await fetchEvents(userAuthToken);\n\n        setEvents(events);\n      }\n    };\n    // still runs on mount\n    updateEvents();\n\n    const interval = setInterval(() => updateEvents(), FIVE_MINUTES);\n    // clean up for clearing interval\n    return () => clearInterval(interval);\n  }, [userAuthToken]);\n\n  const deleteEvent = useCallback(\n    async ({ startTime }) => {\n      // sanity check for array length - which can now be done because events state is initialised as empty array and start time\n      if (!startTime || events.length === 0) return;\n      try {\n        // markEventForDeletion() makes request to backend to delete the specified event.\n        await markEventForDeletion(startTime);\n        const matchesStartTime = events.some(\n          (event) => event.startTime === startTime\n        );\n        // state only updated if start time is in events\n        if (matchesStartTime) {\n          setEvents((prevEvents) =>\n            prevEvents.map((event) =>\n              event.startTime === startTime\n                ? { ...event, deleted: true }\n                : event\n            )\n          );\n        }\n      } catch (error) {\n        console.error(error);\n      }\n    },\n    [events]\n  );\n\n  // memoised value\n  const availableEvents = useMemo(() => {\n    return events.filter(({ deleted }) => !deleted);\n  }, [events]);\n\n  // memoised value\n  const deletedEvents = useMemo(() => {\n    return events.filter(({ deleted }) => deleted);\n  }, [events]);\n\n  // ternary to prevent early returns\n  return events.length > 0 ? (\n    <AppContainer>\n      {/* Events */}\n      <EventsList\n        title=\"Events\"\n        description=\"Click an event to delete it.\"\n        events={availableEvents}\n        onClick={deleteEvent}\n      />\n\n      {/* Deleted events */}\n      <EventsList\n        title=\"Deleted events\"\n        description=\"These events have been marked for deletion:\"\n        events={deletedEvents}\n      />\n    </AppContainer>\n  ) : (\n    <p>Loading...</p>\n  );\n};\n\nexport default App;\n","export const TEN_MINUTES = 600000;\nexport const FIVE_MINUTES = 300000;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport App from \"./components/app\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}